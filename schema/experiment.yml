# https://docs.google.com/document/d/1HTy5oLd0FWwcqirCh6WXFcBAiwHl5rr5hnjg_kEYKsE/edit
$schema: https://json-schema.org/draft/2020-12/schema
title: MAVE experiment definition
$defs:
  Publication:
    type: object
    additionalProperties: false
    properties:
      title:
        type: string
        description: the title of the publication.
      journal:
        type: string
        description: the name of the journal.
      date:
        type: string
        format: date
        description: the date the publication was published.
      ref:
        type: string
        format: uri
        description: >-
          a Universal Record Identifier for the publication.
    required:
      - ref
  Coding:
    type: object
    additionalProperties: false
    properties:
      system:
        description: identity of the terminology system.
        type: string
        pattern: '\S*'
      version:
        description: version of the terminology system.
        type: string
      code:
        description: a code within the terminology system.
        type: string
        pattern: '\S+( \S+)*'
      label:
        description: a human-readable description of the concept associated with the code.
        type: string
  ReferenceSequence:
    type: object
    additionalProperties: false
    properties:
      id:
        type: string
      sha512t24u:
        type: string
        pattern: '[0-9A-Za-z_\-]{32}'
      sequence:
        type: string
        pattern: '^[A-Z*\-]*$'
      sequenceAlphabet:
        type: string
        enum:
          - DNA
          - RNA
          - Protein
  EndogenousLocusLibraryMethod:
    type: object
    additionalProperties: false
    description: a methodology for generating a variant library at an endogenous locus
    properties:
      generationSystem:
        type: string
        description: the system used to generate the library
        enum:
          - SpCas9
          - SaCas9
          - AsCas12a
          - RfsCas13d
      generationMechanism:
        description: the functional mechanism of the library generation method
        type: string
        enum:
          - wildtype nuclease
          - base editor
          - prime editor
      description:
        description: additional details about the variant library generation method
        type: string
    required:
      - system
      - functionality
  InVitroConstructLibraryMethod:
    type: object
    additionalProperties: false
    description: a methodology for generating and integrating an exogenous variant library
    properties:
      generationSystem:
        type: string
        description: the type of method used to generate the library
        enum:
          - oligo-directed mutagenic PCR
          - error-prone PCR
          - nicking mutagenesis
          - microarray synthesis
          - site-directed mutagenesis
          - doped oligo synthesis
          - proprietary method
          - other
      integrationMechanism:
        description: the mechanism for integration/expression of an exogenous construct
        type: string
        enum:
          - native locus replacement
          - insertion of extra-local construct
          - viral integration
          - episomal delivery
          - transfection of RNA
      description:
        description: additional details about the variant library generation method
        type: string
    if:
      properties:
        generationSystem:
          const: other
    then:
      required:
        - generationSystem
        - description
    else:
      required:
        - generationSystem
  VariantLibrary:
    type: object
    additionalProperties: false
    description: a collection of sequences that are derived from a common target sequence.
    properties:
      targetSequences:
        description: the collection of sequences used as references from which all variants in the library are defined.
        type: array
        items:
          $ref: "#/$defs/ReferenceSequence"
        minItems: 1
      scope:
        description: the functional scope of DNA elements introduced into the library. DNA elements can have known
          or unknown functions. Example functions include a gene, an exon or set of exons included in a transcript, 
          a set of enhancers, a set of repressors, etc.
        type: object
        properties:
          type:
            description: the scope type for elements introduced into the library.
            type: string
            enum:
              - Coding
              - Intronic
              - Non-coding, regulatory
              - Non-coding, other
          description:
            type: string
            description: additional details about the DNA element scope. For example, distinguishing the mode of
              variant programming/engineering (e.g. all SNV, indels, ClinVar variants etc).
        if:
          properties:
            type:
              const: Non-coding, other
        then:
          required:
            - description
      generationMethod:
        description: the method used for generating the library
        oneOf:
#          - $ref: "#/$defs/EndogenousLocusLibraryMethod"
          - $ref: "#/$defs/InVitroConstructLibraryMethod"

#      deliveryMethod:
#        description: a description of how the variant library was delivered to the model system for phenotype
#          evaluation.
#        type: object
#        properties:
#          type:
#            $ref: "#/$defs/coding"
#            description: a coding defining the delivery method.
#          description:
#            type: string
#            description: additional details about the delivery method.
#        required:
#          - type
    required:
      - scope
      - targetSequences
      - generationMethod
#      - deliveryMethod
#  phenotypicAssay:
#    description: a physical adjudication of a model system that allows for systematic interrogation of a functional
#      read-out for a large amount of genetic variants.
#    type: object
#    properties:
#      dimensionality:
#        type: object
#        description: dimensionality of phenotyping assay. Describes how many phenotypes and of what complexity
#          are included in the map.
#        properties:
#          type:
#            type:
#              $ref: "#/$defs/coding" #todo: make codings for this concept
#            description: a coding defining the dimensionality of the assay as single or multiple functional
#              readouts.
#          description:
#            type: string
#            description: additional details about the dimensionality of the assay.
#        required:
#          - type
#      method:
#        description: the assay method, defining the molecular properties interrogated.
#        type: object
#        properties:
#          type:
#            $ref: "#/$defs/coding" #todo: make codings for this concept
#            description: a coding defining the assay method as a type of assay. This should be a coding
#              descending from the "assay" concept in the ontology of biomedical investigations (OBI:0000070).
#          description:
#            type: string
#            description: additional details about the assay method.
#        required:
#          - type
#      relevance:
#        description: the disease or biological processes the assay is relevant to.
#        type: array
#        items:
#          - $ref: "#/$defs/coding"
#        minItems: 1
#      modelSystem:
#        description: the model system context that influences expression of the phenotype.
#        type: object
#        properties:
#          type:
#            $ref: "#/$defs/coding"
#            description: a coding defining the model system.
#          description:
#            type: string
#            description: additional details about the model system.
#    required:
#      - dimensionality
#      - method
#      - relevance
#      - modelSystem
#  scoreSet:
#    description: a set of assayed variants and their phenotypic scores.
#    type: object
#    properties:
#      variantScores:
#        description: a set of variants and their phenotypic scores.
#        type: array
#        items:
#          - type: object
#            properties:
#              variant:
#                type: object
#                description: a variant associated with a phenotypic score.
#                properties:
#                  vrs:
#                    # $ref: "https://w3id.org/ga4gh/vrs/1.3/vrs.json#/definitions/Variation"
#                    type: object
#                    description: a computable description of the variant using GA4GH VRS.
#                  mave-hgvs:
#                    type: string
#                    description: a human-readable description of the variant using MAVE-HGVS.
#                anyOf:
#                  - required:
#                      - vrs
#                  - required:
#                      - mave-hgvs
#              score:
#                type: number
#                description: a phenotypic score associated with a variant.
#            required:
#              - variant
#              - score
#        minItems: 1
#      sequencing:
#        description: the sequencing strategy used to identify variants in the score set.
#    required:
#      - sequencing
#      - variant_scores
type: object
additionalProperties: false
properties:
  title:
    description: the title of the MAVE experiment.
    type: string
  abstract:
    description: an abstract describing the MAVE experiment.
    type: string
  publication:
    description: the primary publication describing this experiment.
    $ref: "#/$defs/Publication"
  variantLibrary:
    description: characteristics of the variant library generation process.
    $ref: "#/$defs/VariantLibrary"
#  phenotypicAssay:
#    $ref: "#/$defs/phenotypicAssay"
#  scoreSets:
#    type: array
#    items:
#      - $ref: "#/$defs/scoreSet"
#    minItems: 1
required:
  - title
  - abstract
  - variantLibrary
#    - phenotypicAssay
#    - scoreSet